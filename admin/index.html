<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KURA | ENTERPRISE ADMIN V8.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- LIBRER√çAS PARA PDF Y EXCEL -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { --neon-red: #ff003c; --acid-green: #ccff00; --cyber-black: #050505; --dark-gray: #111; --holo-blue: #00f3ff; }
        body { font-family: 'Chakra Petch', sans-serif; background-color: var(--cyber-black); color: #e5e5e5; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .cyber-input { background: var(--dark-gray); border: 1px solid #333; color: white; font-family: 'JetBrains Mono', monospace; transition: all 0.2s; }
        .cyber-input:focus { border-color: var(--acid-green); outline: none; box-shadow: 0 0 10px rgba(204, 255, 0, 0.2); }
        .cyber-btn { clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); transition: all 0.2s; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        .cyber-btn:hover { transform: translateY(-2px); filter: brightness(1.2); }
        .cyber-card { border: 1px solid #222; background: #0a0a0a; position: relative; transition: border-color 0.3s; }
        .cyber-card:hover { border-color: var(--acid-green); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #000; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--acid-green); }
        .upload-area { border: 2px dashed #333; transition: all 0.3s; cursor: pointer; position: relative; }
        .upload-area:hover { border-color: var(--acid-green); background: rgba(204,255,0,0.05); }
        
        /* Animaciones */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        .nav-active { background: #111; color: var(--acid-green); border-left-color: var(--acid-green) !important; }
        .floating-alert { position: fixed; bottom: 20px; right: 20px; z-index: 50; animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row md:overflow-hidden relative bg-black">

    <!-- LOGIN SCREEN -->
    <div id="login-overlay" class="fixed inset-0 z-[100] flex flex-col items-center justify-center p-4 bg-black">
        <div class="w-full max-w-md bg-[#0a0a0a] border border-[#333] p-8 shadow-[0_0_50px_rgba(204,255,0,0.1)] relative overflow-hidden flex flex-col items-center">
            <h1 class="text-4xl font-black italic tracking-tighter text-white mb-2">KURA<span class="text-[#ff003c]">ADMIN</span></h1>
            <p class="text-[10px] font-mono text-neutral-500 mb-6">SYSTEM V8.1 // UX PATCH</p>
            <form id="loginForm" class="space-y-4 w-full">
                <input type="email" id="email" class="cyber-input w-full p-4 text-sm" placeholder="ID DE COMANDO" required>
                <input type="password" id="password" class="cyber-input w-full p-4 text-sm" placeholder="CLAVE DE ACCESO" required>
                <div id="loginError" class="text-red-500 text-xs font-mono hidden text-center">ACCESO DENEGADO</div>
                <button type="submit" id="loginBtn" class="cyber-btn w-full bg-[#ff003c] text-white py-4 mt-4 flex items-center justify-center gap-2 hover:shadow-[0_0_20px_rgba(255,0,60,0.5)]">
                    <i data-lucide="fingerprint"></i> INICIAR SISTEMA
                </button>
            </form>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="w-full md:w-64 bg-[#0a0a0a] border-r border-[#222] flex flex-col z-20 shrink-0">
        <div class="p-6 border-b border-[#222]">
            <h1 class="text-2xl font-black italic tracking-tighter text-white">KURA<span class="text-[#ccff00]">OS</span></h1>
            <p class="text-[10px] text-neutral-500 font-mono mt-1 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> ONLINE V8.1
            </p>
        </div>
        <nav class="flex-1 p-4 space-y-2 font-mono text-xs">
            <button onclick="switchTab('products')" id="tab-products" class="nav-btn w-full text-left p-3 border-l-2 border-transparent hover:border-white hover:bg-[#111] hover:text-white text-neutral-400 flex items-center gap-3 transition-all"><i data-lucide="package"></i> INVENTARIO</button>
            <button onclick="switchTab('pos')" id="tab-pos" class="nav-btn w-full text-left p-3 border-l-2 border-transparent hover:border-white hover:bg-[#111] hover:text-white text-neutral-400 flex items-center gap-3 transition-all"><i data-lucide="scan-barcode"></i> P.O.S / CAJA</button>
            <button onclick="switchTab('orders')" id="tab-orders" class="nav-btn w-full text-left p-3 border-l-2 border-transparent hover:border-white hover:bg-[#111] hover:text-white text-neutral-400 flex items-center gap-3 transition-all"><i data-lucide="list-ordered"></i> √ìRDENES</button>
            <button onclick="switchTab('reports')" id="tab-reports" class="nav-btn w-full text-left p-3 border-l-2 border-transparent hover:border-white hover:bg-[#111] hover:text-white text-neutral-400 flex items-center gap-3 transition-all"><i data-lucide="bar-chart-3"></i> REPORTES</button>
            <button onclick="switchTab('landing')" id="tab-landing" class="nav-btn w-full text-left p-3 border-l-2 border-transparent hover:border-white hover:bg-[#111] hover:text-white text-neutral-400 flex items-center gap-3 transition-all"><i data-lucide="layout-template"></i> PORTADA</button>
            <button onclick="switchTab('config')" id="tab-config" class="nav-btn w-full text-left p-3 border-l-2 border-transparent hover:border-white hover:bg-[#111] hover:text-white text-neutral-400 flex items-center gap-3 transition-all"><i data-lucide="settings"></i> AJUSTES</button>
        </nav>
        <div class="p-4 border-t border-[#222]">
            <button onclick="logout()" class="w-full text-left text-xs font-mono text-red-500 hover:text-white flex items-center gap-2"><i data-lucide="log-out" width="14"></i> DESCONECTAR</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 bg-black relative md:overflow-y-auto md:h-screen h-auto custom-scrollbar">
        
        <!-- VISTA PRODUCTOS -->
        <div id="view-products" class="view-section hidden p-6 md:p-10 space-y-6 pb-24">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center sticky top-0 bg-black/95 backdrop-blur z-10 py-4 border-b border-[#222] gap-4">
                <div>
                    <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="box"></i> GESTI√ìN DE STOCK</h2>
                    <p class="text-xs text-gray-500 font-mono">Sincronizado en tiempo real</p>
                </div>
                <div class="flex gap-2">
                     <input type="text" id="productSearch" placeholder="Buscar item..." class="cyber-input px-4 py-2 text-xs w-48" onkeyup="filterProducts()">
                    <button onclick="openModal()" class="cyber-btn bg-[#ccff00] text-black px-6 py-2 flex items-center gap-2 text-xs hover:bg-white"><i data-lucide="plus"></i> NUEVO</button>
                </div>
            </div>
            <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <div class="text-white font-mono animate-pulse">Cargando base de datos...</div>
            </div>
        </div>

        <!-- VISTA POS -->
        <div id="view-pos" class="view-section hidden p-4 md:p-6 pb-24 h-full flex flex-col md:flex-row gap-6">
            <div class="flex-1 flex flex-col h-full">
                <div class="mb-4 sticky top-0 bg-black z-10 py-2">
                    <input type="text" id="posSearch" placeholder="Escanear o Buscar producto..." class="cyber-input w-full p-4 text-lg border-[#333] focus:border-[#ccff00]" onkeyup="filterPos()" autofocus>
                </div>
                <div id="posGrid" class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto custom-scrollbar pb-20"></div>
            </div>
            <div class="w-full md:w-[400px] bg-[#0a0a0a] border-l border-[#222] flex flex-col h-[calc(100vh-80px)] sticky top-0 shadow-2xl">
                <div class="p-4 border-b border-[#222] bg-[#111] flex justify-between items-center">
                    <h3 class="font-bold text-[#ccff00] flex items-center gap-2"><i data-lucide="shopping-cart"></i> ORDEN ACTUAL</h3>
                    <button onclick="clearPosCart()" class="text-xs text-red-500 hover:text-white flex items-center gap-1 uppercase font-bold"><i data-lucide="trash-2" width="12"></i> Limpiar</button>
                </div>
                <div class="p-4 border-b border-[#333] space-y-2 bg-[#050505]">
                    <input id="posClientName" class="cyber-input w-full p-2 text-xs" placeholder="Nombre Cliente (Opcional)">
                    <input id="posClientPhone" class="cyber-input w-full p-2 text-xs" placeholder="WhatsApp (Opcional)">
                </div>
                <div id="posCart" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar bg-black/50">
                    <div class="text-center text-gray-700 text-xs mt-10 font-mono">ESPERANDO ITEMS...</div>
                </div>
                <div class="p-6 border-t border-[#222] bg-[#111] space-y-4 shadow-[0_-10px_30px_rgba(0,0,0,0.5)]">
                    <div class="flex justify-between text-2xl font-black text-white font-mono"><span>TOTAL</span><span id="posTotal">C$ 0.00</span></div>
                    <button onclick="openPaymentModal()" class="cyber-btn w-full bg-[#ccff00] text-black py-4 text-xl flex justify-center items-center gap-3 hover:bg-white hover:scale-[1.02]">
                        <i data-lucide="credit-card"></i> PROCESAR PAGO
                    </button>
                </div>
            </div>
        </div>

        <!-- VISTA √ìRDENES -->
        <div id="view-orders" class="view-section hidden p-6 md:p-10 space-y-6 pb-24">
            <div class="sticky top-0 bg-black py-4 z-10 border-b border-[#222] flex justify-between items-center">
                <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="list-ordered"></i> HISTORIAL DE √ìRDENES</h2>
                <input type="text" id="orderSearchInput" placeholder="Buscar ID o Cliente..." class="cyber-input px-3 py-2 text-xs w-64" onkeyup="filterOrders()">
            </div>
            <div class="overflow-x-auto border border-[#222] bg-[#0a0a0a] rounded-sm">
                <table class="w-full text-left text-sm">
                    <thead class="bg-[#111] text-neutral-400 font-mono text-xs uppercase"><tr><th class="p-4">ID</th><th class="p-4">Fecha</th><th class="p-4">Cliente</th><th class="p-4">Total</th><th class="p-4">Env√≠o</th><th class="p-4">M√©todo</th><th class="p-4">Estado</th><th class="p-4">Acci√≥n</th></tr></thead>
                    <tbody id="ordersTableBody" class="divide-y divide-[#222] text-neutral-300 font-mono text-xs"></tbody>
                </table>
                <div class="p-4 text-center">
                    <button onclick="loadMoreOrders()" class="text-xs text-gray-500 hover:text-[#ccff00]">CARGAR M√ÅS ANTIGUAS...</button>
                </div>
            </div>
        </div>

        <!-- VISTA REPORTES MEJORADA -->
        <div id="view-reports" class="view-section hidden p-6 md:p-10 space-y-6 pb-24">
            <div class="sticky top-0 bg-black py-4 z-10 border-b border-[#222]">
                <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="bar-chart-3"></i> REPORTES DE VENTA</h2>
            </div>
            
            <div class="bg-[#0a0a0a] border border-[#222] p-6 space-y-6">
                <!-- Selectores R√°pidos -->
                <div class="flex gap-2 border-b border-[#333] pb-4">
                    <button onclick="setReportDate('today')" class="text-[10px] bg-[#111] border border-[#333] text-gray-400 hover:text-white hover:border-[#ccff00] px-3 py-1 uppercase">Hoy</button>
                    <button onclick="setReportDate('week')" class="text-[10px] bg-[#111] border border-[#333] text-gray-400 hover:text-white hover:border-[#ccff00] px-3 py-1 uppercase">Esta Semana</button>
                    <button onclick="setReportDate('month')" class="text-[10px] bg-[#111] border border-[#333] text-gray-400 hover:text-white hover:border-[#ccff00] px-3 py-1 uppercase">Este Mes</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                    <!-- Rango de Fechas Integrado -->
                    <div class="lg:col-span-2">
                         <label class="text-[10px] text-gray-500 uppercase font-bold mb-1 block">RANGO DE FECHAS</label>
                         <div class="flex items-center gap-2 bg-[#111] p-2 border border-[#333] h-[42px]">
                             <i data-lucide="calendar" class="text-[#ccff00] w-4 h-4"></i>
                             <input type="date" id="reportStartDate" class="bg-transparent border-none text-white text-xs outline-none w-full" placeholder="Inicio">
                             <span class="text-gray-500">‚ûú</span>
                             <input type="date" id="reportEndDate" class="bg-transparent border-none text-white text-xs outline-none w-full" placeholder="Fin">
                         </div>
                    </div>
                    
                    <div>
                         <label class="text-[10px] text-gray-500 uppercase font-bold mb-1 block">BUSCAR CLIENTE</label>
                         <input type="text" id="reportSearch" placeholder="Nombre..." class="cyber-input w-full p-2 text-sm h-[42px]">
                    </div>
                    <button onclick="generateReport()" class="cyber-btn bg-[#00f3ff] text-black h-[42px] flex items-center justify-center gap-2 font-bold"><i data-lucide="filter"></i> FILTRAR</button>
                </div>
            </div>

            <div class="flex gap-2">
                <button onclick="exportToExcel()" class="cyber-btn bg-[#107c41] text-white px-4 py-2 text-xs flex items-center gap-2"><i data-lucide="file-spreadsheet"></i> EXPORTAR EXCEL</button>
                <button onclick="exportToPDFReport()" class="cyber-btn bg-[#ff003c] text-white px-4 py-2 text-xs flex items-center gap-2"><i data-lucide="file-text"></i> EXPORTAR PDF</button>
            </div>

            <div class="overflow-x-auto border border-[#222] bg-[#0a0a0a]">
                <table class="w-full text-left text-sm">
                    <thead class="bg-[#111] text-neutral-400 font-mono text-xs uppercase"><tr><th class="p-3">Fecha</th><th class="p-3">Orden</th><th class="p-3">Cliente</th><th class="p-3 text-right">Monto</th></tr></thead>
                    <tbody id="reportsTableBody" class="divide-y divide-[#222] text-neutral-300 font-mono text-xs"></tbody>
                    <tfoot class="bg-[#111] text-white font-bold border-t border-[#333]">
                        <tr>
                            <td colspan="3" class="p-3 text-right uppercase text-[#ccff00]">Total Ventas:</td>
                            <td class="p-3 text-right text-xl" id="reportTotalSum">C$ 0.00</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- VISTA LANDING (PORTADA & REDES) -->
        <div id="view-landing" class="view-section hidden p-6 md:p-10 space-y-6 pb-24">
            <div class="flex justify-between items-center sticky top-0 bg-black/90 backdrop-blur z-10 py-4 border-b border-[#222]">
                <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="layout-template"></i> PORTADA & REDES</h2>
                <button onclick="saveLandingConfig()" class="cyber-btn bg-[#ff003c] text-white px-6 py-3 flex items-center gap-2"><i data-lucide="save"></i> GUARDAR</button>
            </div>
            <div class="max-w-4xl mx-auto space-y-8">
                <!-- SECCI√ìN APARIENCIA -->
                <div class="bg-[#0a0a0a] border border-[#222] p-6 space-y-6">
                     <h3 class="text-[#ccff00] font-bold border-b border-[#333] pb-2">APARIENCIA WEB</h3>
                     <div class="space-y-2">
                         <label class="text-[10px] text-gray-500 uppercase font-bold">LOGO DE LA TIENDA (Para Facturas y Web)</label>
                         <div class="flex gap-2">
                             <input id="landingLogo" class="cyber-input flex-1 p-2 text-[#00f3ff]" placeholder="https://...">
                             <div class="upload-area w-10 flex items-center justify-center bg-[#111]">
                                 <input type="file" accept="image/*" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer" onchange="window.uploadGenericImage(this, 'landingLogo')">
                                 <i data-lucide="upload" width="16" class="text-gray-500"></i>
                             </div>
                         </div>
                     </div>
                     <div class="space-y-2">
                         <label class="text-[10px] text-gray-500 uppercase font-bold">FONDO DE PORTADA</label>
                         <div class="flex gap-2">
                             <input id="landingBgImage" class="cyber-input flex-1 p-2" placeholder="https://...">
                             <div class="upload-area w-10 flex items-center justify-center bg-[#111]">
                                 <input type="file" accept="image/*" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer" onchange="window.uploadGenericImage(this, 'landingBgImage')">
                                 <i data-lucide="upload" width="16" class="text-gray-500"></i>
                             </div>
                         </div>
                     </div>
                     <div class="grid md:grid-cols-2 gap-4">
                         <div><label class="text-[10px] text-gray-500">T√çTULO PRINCIPAL</label><input id="landingTitle" class="cyber-input w-full p-2"></div>
                         <div><label class="text-[10px] text-gray-500">SUBT√çTULO</label><input id="landingSubtitle" class="cyber-input w-full p-2"></div>
                         <div><label class="text-[10px] text-gray-500">TEXTO BOT√ìN</label><input id="landingBtnText" class="cyber-input w-full p-2" placeholder="VER CAT√ÅLOGO"></div>
                         <div><label class="text-[10px] text-gray-500">URL TIENDA (Bot√≥n)</label><input id="landingStoreUrl" class="cyber-input w-full p-2"></div>
                     </div>
                </div>

                <!-- SECCI√ìN REDES (FOOTER) -->
                <div class="bg-[#0a0a0a] border border-[#222] p-6 space-y-6">
                     <h3 class="text-[#00f3ff] font-bold border-b border-[#333] pb-2">REDES SOCIALES (PIE DE P√ÅGINA)</h3>
                     <div class="grid md:grid-cols-2 gap-4">
                         <div><label class="text-[10px] text-gray-500">INSTAGRAM (Usuario o URL)</label><input id="landingInsta" class="cyber-input w-full p-2"></div>
                         <div><label class="text-[10px] text-gray-500">TIKTOK (Usuario o URL)</label><input id="landingTiktok" class="cyber-input w-full p-2"></div>
                         <div class="col-span-2"><label class="text-[10px] text-gray-500">WHATSAPP (N√∫mero con c√≥digo, ej: 50588888888)</label><input id="landingWhatsapp" class="cyber-input w-full p-2 text-[#ccff00] font-bold"></div>
                     </div>
                </div>
            </div>
        </div>

        <!-- VISTA CONFIGURACI√ìN (CATEGOR√çAS Y PAGOS MEJORADOS) -->
        <div id="view-config" class="view-section hidden p-6 md:p-10 space-y-6 pb-24">
            <div class="flex justify-between items-center sticky top-0 bg-black/90 backdrop-blur z-10 py-4 border-b border-[#222]">
                <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="settings"></i> AJUSTES DE TIENDA</h2>
                <button onclick="saveGlobalConfig()" class="cyber-btn bg-[#ccff00] text-black px-6 py-2 flex items-center gap-2"><i data-lucide="save"></i> GUARDAR CAMBIOS</button>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- CATEGOR√çAS -->
                <div class="space-y-6">
                    <div class="bg-[#0a0a0a] border border-[#222] p-6">
                        <h3 class="text-[#00f3ff] font-bold border-b border-[#333] pb-2 mb-4 flex justify-between items-center">
                            CATEGOR√çAS DE PRODUCTOS
                        </h3>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="newCategoryInput" placeholder="NUEVA CATEGOR√çA..." class="cyber-input flex-1 p-2 text-xs uppercase">
                            <button onclick="addCategoryUI()" class="bg-[#ccff00] text-black px-4 text-xs font-bold hover:bg-white">AGREGAR</button>
                        </div>
                        <div id="categoriesContainer" class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar"></div>
                    </div>
                </div>
                
                <!-- M√âTODOS DE PAGO AVANZADOS -->
                <div class="space-y-6">
                     <div class="bg-[#0a0a0a] border border-[#222] p-6">
                        <h3 class="text-[#ff003c] font-bold border-b border-[#333] pb-2 mb-4">M√âTODOS DE PAGO</h3>
                        <p class="text-[10px] text-gray-500 mb-4">Configura Cuentas Bancarias o Links de Pago. Usa el "Nombre Interno" para vincular un Link espec√≠fico a un producto.</p>
                        <div id="paymentMethodsContainer" class="space-y-4"></div>
                        <button onclick="addPaymentMethodInput()" class="w-full py-4 border border-dashed border-[#333] text-gray-500 text-xs hover:border-[#ccff00] hover:text-[#ccff00] mt-4 flex items-center justify-center gap-2 font-bold"><i data-lucide="plus"></i> AGREGAR M√âTODO DE PAGO</button>
                     </div>
                </div>
            </div>
        </div>
    </main>

    <!-- NOTIFICACI√ìN FLOTANTE (NUEVAS √ìRDENES) -->
    <button id="newOrdersAlert" onclick="refreshOrdersManual()" class="hidden floating-alert bg-[#ff003c] text-white px-6 py-3 shadow-[0_0_20px_#ff003c] font-bold flex items-center gap-3 rounded-sm hover:scale-105 transition-transform">
        <i data-lucide="bell-ring" class="animate-bounce"></i>
        <span><span id="newOrdersCount">0</span> NUEVAS √ìRDENES</span>
        <span class="bg-white text-black text-[10px] px-1 rounded ml-2">ACTUALIZAR</span>
    </button>

    <!-- MODAL PRODUCTO -->
    <div id="productModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="absolute top-0 right-0 h-full w-full md:w-[500px] bg-[#0f0f0f] border-l border-[#222] shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="modalContent">
            <div class="p-6 border-b border-[#222] flex justify-between items-center bg-[#111]">
                <h3 id="modalTitle" class="text-lg font-bold text-white uppercase font-mono">PRODUCTO</h3>
                <button onclick="closeModal()" class="text-neutral-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <form id="productForm" class="flex-1 overflow-y-auto p-6 space-y-5 custom-scrollbar">
                <input type="hidden" id="editId"><input type="hidden" id="currentImageUrl">
                <div class="flex items-center justify-between bg-[#050505] p-3 border border-[#222]">
                    <span class="text-xs font-bold uppercase text-white">Visible en Tienda</span>
                    <input type="checkbox" id="isActive" class="accent-[#ccff00] w-5 h-5">
                </div>
                
                <div><label class="text-xs text-gray-500 font-mono">NOMBRE DEL ITEM</label><input type="text" id="name" required class="cyber-input w-full p-3 text-sm font-bold"></div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs text-gray-500 font-mono">PRECIO (C$)</label><input type="number" step="0.01" id="price" required class="cyber-input w-full p-3 text-sm font-bold text-[#ccff00]"></div>
                    <div><label class="text-xs text-[#ff003c] font-mono">PRECIO OFERTA (Opc)</label><input type="number" step="0.01" id="comparePrice" class="cyber-input w-full p-3 text-sm border-[#ff003c]/30"></div>
                </div>

                <div>
                    <label class="text-xs text-gray-500 font-mono">CATEGOR√çA</label>
                    <select id="categorySelect" class="cyber-input w-full p-3 text-sm uppercase cursor-pointer"></select>
                </div>
                
                <!-- VINCULACI√ìN DE LINK DE PAGO -->
                <div class="bg-[#111] p-3 border border-l-2 border-[#00f3ff]">
                    <label class="text-[10px] text-[#00f3ff] font-bold uppercase flex items-center gap-2">
                        <i data-lucide="link"></i> LINK DE PAGO DIRECTO (OPCIONAL)
                    </label>
                    <p class="text-[9px] text-gray-500 mb-2">Si seleccionas uno, el bot√≥n de compra llevar√° directo a este link.</p>
                    <select id="linkedPaymentMethod" class="cyber-input w-full p-2 text-xs uppercase cursor-pointer text-[#00f3ff]">
                        <option value="">-- Usar Checkout Normal --</option>
                    </select>
                </div>
                
                <!-- CONTROL DE STOCK -->
                <div class="bg-[#0a0a0a] border border-[#333] p-3 rounded-sm">
                    <label class="text-xs font-bold text-[#ccff00] mb-2 block flex justify-between">
                        <span>VARIANTES & STOCK</span>
                        <span class="text-[10px] text-gray-500">El stock 0 oculta la talla en web</span>
                    </label>
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="newVariantSize" placeholder="TALLA (Ej: M)" class="cyber-input w-1/2 p-2 text-xs uppercase font-bold">
                        <input type="number" id="newVariantQty" placeholder="CANTIDAD" class="cyber-input w-1/4 p-2 text-xs font-bold">
                        <button type="button" onclick="addVariant()" class="bg-[#333] text-white px-3 hover:bg-[#ccff00] hover:text-black transition-colors"><i data-lucide="plus" width="14"></i></button>
                    </div>
                    <div id="variantsList" class="space-y-1 max-h-40 overflow-y-auto custom-scrollbar p-1"></div>
                    <input type="hidden" id="variantsData" value="{}">
                </div>

                <div><label class="text-xs text-gray-500 font-mono">DESCRIPCI√ìN</label><textarea id="description" rows="3" class="cyber-input w-full p-3 text-sm"></textarea></div>
                
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 font-mono">IMAGEN DEL PRODUCTO</label>
                    <div class="flex gap-2">
                        <input type="text" id="manualImageUrl" placeholder="Pegar URL existente..." class="cyber-input flex-1 p-2 text-xs text-gray-400" onchange="updatePreviewFromUrl()">
                    </div>
                    <div class="border border-dashed border-[#333] p-4 text-center hover:border-[#ccff00] transition-colors relative group cursor-pointer">
                        <input type="file" id="imageFile" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="window.uploadGenericImage(this, 'currentImageUrl', 'imgPreview')">
                        <div class="text-xs text-gray-500 group-hover:text-white pointer-events-none">
                            <i data-lucide="upload-cloud" class="mx-auto mb-2"></i>
                            Clic para subir nueva imagen
                        </div>
                    </div>
                    <div id="imagePreviewContainer" class="hidden relative mt-2 w-full h-48 bg-[#050505] border border-[#222] flex items-center justify-center">
                        <img id="imgPreview" src="" class="h-full object-contain">
                        <div id="uploadingSpinner" class="absolute inset-0 bg-black/80 flex items-center justify-center text-[#ccff00] hidden font-mono text-xs">SUBIENDO...</div>
                    </div>
                </div>

            </form>
            <div class="p-6 border-t border-[#222] bg-[#0a0a0a] flex gap-4">
                <button onclick="deleteProduct()" id="btnDeleteProd" class="hidden cyber-btn bg-black border border-red-900 text-red-500 py-4 px-4 hover:bg-red-900 hover:text-white"><i data-lucide="trash"></i></button>
                <button onclick="saveProductForm()" id="saveBtn" class="cyber-btn flex-1 bg-[#ff003c] text-white py-4 flex items-center justify-center gap-2 hover:bg-white hover:text-black">GUARDAR DATOS</button>
            </div>
        </div>
    </div>

    <!-- MODAL SELECCI√ìN VARIANTE POS -->
    <div id="posVariantModal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closePosVariantModal()"></div>
        <div class="bg-[#111] border border-[#333] w-full max-w-sm relative z-10 p-6 shadow-2xl flex flex-col">
            <h3 class="text-[#ccff00] font-mono text-lg font-bold mb-4 flex items-center gap-2"><i data-lucide="layers"></i> SELECCIONAR TALLA</h3>
            <p id="posVariantProductName" class="text-white mb-4 text-sm border-b border-[#333] pb-2"></p>
            <div id="posVariantOptions" class="grid grid-cols-2 gap-2 max-h-64 overflow-y-auto custom-scrollbar"></div>
            <button onclick="closePosVariantModal()" class="mt-6 w-full text-center text-gray-500 hover:text-white text-xs font-mono py-2">CANCELAR</button>
        </div>
    </div>

    <!-- MODAL COBRO (CHECKOUT POS) -->
    <div id="posPaymentModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-sm" onclick="closePaymentModal()"></div>
        <div class="bg-[#111] border border-[#333] w-full max-w-md relative z-10 p-8 shadow-[0_0_50px_rgba(204,255,0,0.2)] flex flex-col animate-slide-up">
            <h3 class="text-2xl font-black text-white text-center mb-6 font-mono">CONFIRMAR VENTA</h3>
            <div class="space-y-4 mb-6">
                <div class="flex justify-between text-neutral-400 text-sm"><span>Cliente:</span><span id="confClient" class="text-white font-bold"></span></div>
                <div class="flex justify-between text-neutral-400 text-sm"><span>Items:</span><span id="confItems" class="text-white font-bold"></span></div>
                <div class="flex justify-between text-3xl font-black text-[#ccff00] border-t border-b border-[#333] py-4 font-mono"><span>TOTAL:</span><span id="confTotal"></span></div>
            </div>
            <label class="text-[10px] text-gray-500 uppercase font-bold mb-2">M√âTODO DE PAGO</label>
            <div class="grid grid-cols-2 gap-2 mb-6">
                <button onclick="selectPayment('Efectivo')" class="pay-opt p-3 border border-[#333] text-sm hover:border-[#ccff00] hover:bg-[#222] text-white focus:bg-[#ccff00] focus:text-black font-bold transition-all">üíµ EFECTIVO</button>
                <button onclick="selectPayment('Tarjeta')" class="pay-opt p-3 border border-[#333] text-sm hover:border-[#ccff00] hover:bg-[#222] text-white focus:bg-[#ccff00] focus:text-black font-bold transition-all">üí≥ TARJETA</button>
                <button onclick="selectPayment('Transferencia')" class="pay-opt p-3 border border-[#333] text-sm hover:border-[#ccff00] hover:bg-[#222] text-white focus:bg-[#ccff00] focus:text-black font-bold transition-all">üè¶ TRANSF</button>
                <button onclick="selectPayment('Link')" class="pay-opt p-3 border border-[#333] text-sm hover:border-[#ccff00] hover:bg-[#222] text-white focus:bg-[#ccff00] focus:text-black font-bold transition-all">üîó LINK</button>
            </div>
            <input type="hidden" id="selectedPaymentMethod" value="Efectivo">
            <button onclick="confirmPosSale()" id="btnProcessPayment" class="cyber-btn w-full bg-[#ccff00] text-black py-4 font-bold text-xl hover:bg-white transition-colors uppercase">Facturar</button>
            <button onclick="closePaymentModal()" class="mt-4 text-xs text-neutral-500 hover:text-white text-center">CANCELAR</button>
        </div>
    </div>

    <!-- MODAL DETALLE ORDEN & FACTURA -->
    <div id="invoiceViewerModal" class="fixed inset-0 z-[101] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-sm" onclick="closeInvoiceViewerModal()"></div>
        <div class="bg-[#111] border border-[#333] w-full max-w-5xl h-[90vh] relative z-10 p-0 shadow-2xl flex flex-col animate-slide-up">
            <div class="p-4 border-b border-[#333] flex justify-between items-center bg-[#0a0a0a]">
                <h3 class="text-[#ccff00] font-mono text-lg font-bold">DETALLE DE ORDEN <span id="viewerOrderId"></span></h3>
                <button onclick="closeInvoiceViewerModal()" class="text-white hover:text-red-500"><i data-lucide="x"></i></button>
            </div>
            
            <div class="flex flex-col md:flex-row flex-1 overflow-hidden">
                <!-- COLUMNA IZQUIERDA: DETALLES Y ESTADO -->
                <div class="w-full md:w-1/3 border-r border-[#222] p-6 overflow-y-auto custom-scrollbar bg-[#050505] flex flex-col">
                    <h4 class="text-white font-bold mb-4 uppercase text-xs border-b border-[#333] pb-2">Informaci√≥n del Cliente</h4>
                    <div id="orderDetailPanel" class="space-y-4 text-sm text-gray-300"></div>
                    
                    <div class="mt-8 pt-4 border-t border-[#333]">
                         <h4 class="text-white font-bold mb-2 uppercase text-xs">Actualizar Estado</h4>
                         <select id="orderStatusUpdate" class="cyber-input w-full p-2 mb-2 text-xs uppercase">
                            <option value="pending">üü° Pendiente</option>
                            <option value="completed">üü¢ Completado</option>
                            <option value="cancelled">üî¥ Cancelado</option>
                         </select>
                         <button id="btnUpdateStatus" class="w-full bg-[#222] hover:bg-white hover:text-black text-white py-2 text-xs font-bold border border-[#333]">GUARDAR ESTADO</button>
                    </div>

                    <div id="paymentProofContainer" class="mt-8 hidden">
                        <h4 class="text-[#00f3ff] font-bold mb-2 uppercase text-xs">Comprobante de Pago</h4>
                        <a id="proofLink" href="#" target="_blank" class="block w-full h-48 border border-dashed border-[#333] hover:border-[#00f3ff] flex items-center justify-center bg-[#111] relative group">
                            <img id="proofImg" src="" class="h-full w-full object-contain hidden">
                            <div class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity">
                                <span class="text-white text-xs font-bold">CLIC PARA AMPLIAR</span>
                            </div>
                            <span id="proofText" class="text-xs text-gray-500">Ver Comprobante</span>
                        </a>
                    </div>
                    
                    <!-- Bot√≥n Extra para POS: Finalizar -->
                    <div id="btnFinishPos" class="mt-auto pt-4 hidden">
                         <button onclick="closeInvoiceViewerModal()" class="w-full bg-[#107c41] text-white py-3 font-bold uppercase hover:bg-white hover:text-black transition-all flex items-center justify-center gap-2">
                             <i data-lucide="check-circle"></i> FINALIZAR Y VOLVER A CAJA
                         </button>
                    </div>
                </div>

                <!-- COLUMNA DERECHA: PREVISUALIZACI√ìN PDF -->
                <div class="flex-1 bg-neutral-900 relative flex flex-col">
                    <iframe id="pdfViewer" class="flex-1 w-full h-full border-0"></iframe>
                </div>
            </div>

            <div class="p-4 border-t border-[#333] bg-[#0a0a0a] flex justify-end gap-3">
                 <button id="btnWhatsapp" class="cyber-btn bg-[#25D366] text-black px-4 py-2 text-xs font-bold flex items-center gap-2 hover:bg-[#128C7E]"><i data-lucide="message-circle"></i> ENVIAR AL CLIENTE</button>
                 <button id="btnPrint" class="cyber-btn bg-white text-black px-4 py-2 text-xs font-bold flex items-center gap-2 hover:bg-gray-200"><i data-lucide="printer"></i> IMPRIMIR FACTURA</button>
            </div>
        </div>
    </div>

    <!-- LOGICA -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, serverTimestamp, query, orderBy, onSnapshot, writeBatch, increment, where, limit } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        
        const IMGBB_API_KEY = "b922654effe3a1ab5ac85cc4c23f97b8"; 
        const firebaseConfig = { apiKey: "AIzaSyAztg4F0twRi2NOP8MayAOUYB0ZtHgkss0", authDomain: "kodialabsnic.firebaseapp.com", projectId: "kodialabsnic", storageBucket: "kodialabsnic.firebasestorage.app", messagingSenderId: "740746852984", appId: "1:740746852984:web:972aa34592aef881630b8d" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app); const auth = getAuth(app);

        // ESTADO GLOBAL
        let products = [];
        let allOrders = [];
        let posCart = [];
        let globalConfig = { categories: [], paymentMethods: [] };
        let landingConfig = { logo: "" };
        let currentOrderView = null;
        let unsubscribeProducts = null;
        let unsubscribeNewOrders = null;
        let lastGeneratedPdfBlob = null;
        let initialLoadTime = null;

        // --- AUTH ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('login-overlay').classList.add('hidden');
                initialLoadTime = new Date();
                initData();
            } else {
                if(unsubscribeProducts) unsubscribeProducts();
                if(unsubscribeNewOrders) unsubscribeNewOrders();
                document.getElementById('login-overlay').classList.remove('hidden');
            }
        });

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            btn.innerHTML = 'VERIFICANDO...';
            try { 
                await signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value);
            } catch (error) { 
                document.getElementById('loginError').classList.remove('hidden'); 
                btn.innerHTML = '<i data-lucide="fingerprint"></i> REINTENTAR';
            }
        });
        window.logout = () => signOut(auth);

        // --- INICIALIZACI√ìN DE DATOS ---
        async function initData() {
            try {
                const s = await getDoc(doc(db, "settings", "store_config"));
                if(s.exists()) { 
                    globalConfig = s.data(); 
                    if(!globalConfig.categories) globalConfig.categories = ["GENERAL"];
                    if(!globalConfig.paymentMethods) globalConfig.paymentMethods = [];
                }
                const l = await getDoc(doc(db, "settings", "landing_page_v2"));
                if(l.exists()) { 
                    landingConfig = l.data(); 
                } else {
                    const old = await getDoc(doc(db, "settings", "landing_page"));
                    if(old.exists()) landingConfig = old.data();
                }
                applyConfigToUI();
                applyLandingToUI();
            } catch(e) { console.log("Config init error", e); }

            const qProd = query(collection(db, "products"), orderBy("updatedAt", "desc"));
            unsubscribeProducts = onSnapshot(qProd, (snap) => {
                products = snap.docs.map(d => ({id:d.id, ...d.data()}));
                renderProductsGrid();
                renderPosGrid();
            });

            await loadInitialOrders();
            setupNewOrderListener();
        }

        async function loadInitialOrders() {
            const qOrd = query(collection(db, "orders"), orderBy("date", "desc"), limit(50));
            const snap = await getDocs(qOrd);
            allOrders = snap.docs.map(d => ({id:d.id, ...d.data()}));
            renderOrdersTable();
        }

        function setupNewOrderListener() {
            const qNew = query(collection(db, "orders"), where("date", ">", initialLoadTime));
            unsubscribeNewOrders = onSnapshot(qNew, (snap) => {
                if(!snap.empty) {
                    const count = snap.size;
                    document.getElementById('newOrdersCount').innerText = count;
                    document.getElementById('newOrdersAlert').classList.remove('hidden');
                }
            });
        }
        
        window.refreshOrdersManual = async () => {
             document.getElementById('newOrdersAlert').classList.add('hidden');
             const qOrd = query(collection(db, "orders"), orderBy("date", "desc"), limit(50));
             const snap = await getDocs(qOrd);
             allOrders = snap.docs.map(d => ({id:d.id, ...d.data()}));
             renderOrdersTable();
             initialLoadTime = new Date();
             unsubscribeNewOrders();
             setupNewOrderListener();
        }

        // --- GESTI√ìN DE PRODUCTOS ---
        window.tempVariants = {};
        window.openModal = (id) => {
            document.getElementById('productModal').classList.remove('hidden');
            setTimeout(()=>document.getElementById('modalContent').classList.remove('translate-x-full'), 10);
            
            // Llenar categor√≠as
            const catSelect = document.getElementById('categorySelect');
            catSelect.innerHTML = '<option value="">SIN CATEGOR√çA</option>';
            globalConfig.categories.forEach(c => {
                catSelect.innerHTML += `<option value="${c}">${c}</option>`;
            });

            // Llenar Links de Pago
            const linkSelect = document.getElementById('linkedPaymentMethod');
            linkSelect.innerHTML = '<option value="">-- Usar Checkout Normal --</option>';
            globalConfig.paymentMethods.forEach(pm => {
                if(pm.type === 'link') {
                    linkSelect.innerHTML += `<option value="${pm.internalName}">${pm.internalName || 'Link Sin Nombre'}</option>`;
                }
            });

            if(id) {
                const p = products.find(x => x.id === id);
                document.getElementById('modalTitle').innerText = "EDITAR ITEM";
                document.getElementById('editId').value = p.id;
                document.getElementById('name').value = p.name;
                document.getElementById('price').value = p.price;
                document.getElementById('comparePrice').value = p.comparePrice || '';
                document.getElementById('currentImageUrl').value = p.image || '';
                document.getElementById('manualImageUrl').value = p.image || '';
                document.getElementById('description').value = p.description || '';
                document.getElementById('categorySelect').value = p.category || '';
                document.getElementById('linkedPaymentMethod').value = p.linkedPaymentMethod || ''; // Cargar el link vinculado
                document.getElementById('isActive').checked = p.isActive !== false;
                document.getElementById('btnDeleteProd').classList.remove('hidden');
                if(p.image) {
                    document.getElementById('imgPreview').src = p.image;
                    document.getElementById('imagePreviewContainer').classList.remove('hidden');
                } else {
                    document.getElementById('imagePreviewContainer').classList.add('hidden');
                }
                window.tempVariants = {...p.variants};
            } else {
                document.getElementById('modalTitle').innerText = "NUEVO ITEM";
                document.getElementById('editId').value = "";
                document.getElementById('productForm').reset();
                document.getElementById('currentImageUrl').value = "";
                document.getElementById('manualImageUrl').value = "";
                document.getElementById('imagePreviewContainer').classList.add('hidden');
                document.getElementById('btnDeleteProd').classList.add('hidden');
                window.tempVariants = {};
            }
            renderVariantsList();
        }
        // ... (Funciones de variantes y subida de im√°genes permanecen, pero actualizamos uploadGenericImage)

        // FUNCI√ìN GEN√âRICA PARA SUBIR IM√ÅGENES (Productos, Portada, QR Pagos)
        window.uploadGenericImage = async (input, targetInputId, previewId = null) => {
            const file = input.files[0];
            if(!file) return;
            const fd = new FormData();
            fd.append("image", file);
            
            // Visual feedback
            const parent = input.parentElement;
            const originalBorder = parent.style.borderColor;
            parent.style.borderColor = "#ccff00";
            
            try {
                if(previewId) document.getElementById('uploadingSpinner').classList.remove('hidden'); // Solo si es producto
                
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: fd });
                const data = await res.json();
                
                if(data.success) {
                    document.getElementById(targetInputId).value = data.data.url;
                    // Si hay preview (producto)
                    if(previewId) {
                         const img = document.getElementById(previewId);
                         if(img) {
                             img.src = data.data.url;
                             img.parentElement.classList.remove('hidden');
                         }
                         // Sync manual input if exists
                         const manual = document.getElementById('manualImageUrl');
                         if(manual) manual.value = data.data.url;
                    }
                    alert("Imagen subida correctamente");
                } else { alert("Error al subir imagen"); }
            } catch(err) { console.error(err); alert("Error de red"); }
            finally {
                 parent.style.borderColor = originalBorder || "#333";
                 if(previewId) document.getElementById('uploadingSpinner').classList.add('hidden');
            }
        }
        window.updatePreviewFromUrl = () => {
            const url = document.getElementById('manualImageUrl').value;
            document.getElementById('currentImageUrl').value = url;
            if(url) {
                document.getElementById('imgPreview').src = url;
                document.getElementById('imagePreviewContainer').classList.remove('hidden');
            }
        }
        window.saveProductForm = async () => {
            const btn = document.getElementById('saveBtn');
            btn.innerText = "GUARDANDO..."; btn.disabled = true;
            const id = document.getElementById('editId').value;
            const productData = {
                name: document.getElementById('name').value,
                price: parseFloat(document.getElementById('price').value) || 0,
                comparePrice: parseFloat(document.getElementById('comparePrice').value) || 0,
                image: document.getElementById('currentImageUrl').value,
                variants: window.tempVariants, 
                isActive: document.getElementById('isActive').checked,
                category: document.getElementById('categorySelect').value,
                linkedPaymentMethod: document.getElementById('linkedPaymentMethod').value, // GUARDAR EL LINK
                description: document.getElementById('description').value,
                updatedAt: serverTimestamp()
            };
            try {
                if(id) { await updateDoc(doc(db, "products", id), productData); }
                else { 
                    productData.createdAt = serverTimestamp();
                    await addDoc(collection(db, "products"), productData); 
                }
                closeModal();
            } catch(e) { alert("Error guardando: " + e.message); }
            btn.innerText = "GUARDAR DATOS"; btn.disabled = false;
        }
        // ... (Delete product, close modal, render products, pos logic etc - Unchanged)
        
        // --- RENDERIZADO PRODUCTOS Y POS (Reutilizando funciones previas) ---
        function renderProductsGrid() {
            const grid = document.getElementById('productsGrid');
            const search = document.getElementById('productSearch').value.toLowerCase();
            grid.innerHTML = '';
            const filtered = products.filter(p => p.name.toLowerCase().includes(search));
            filtered.forEach(p => {
                let totalStock = 0; let stockBadges = "";
                if (p.variants) {
                    Object.entries(p.variants).forEach(([size, qty]) => {
                        qty = Number(qty); totalStock += qty;
                        const colorClass = qty > 0 ? 'text-gray-400' : 'text-red-500 font-bold';
                        stockBadges += `<span class="text-[10px] bg-[#111] px-1 border border-[#333] ${colorClass}">${size}:${qty}</span> `;
                    });
                } else { totalStock = '‚àû'; }
                const card = document.createElement('div');
                card.className = `cyber-card p-3 flex flex-col gap-2 ${!p.isActive ? 'opacity-50 border-red-900' : ''}`;
                card.innerHTML = `
                    <div class="aspect-square bg-[#111] relative overflow-hidden group">
                        <img src="${p.image || 'https://via.placeholder.com/150'}" class="w-full h-full object-cover transition-transform group-hover:scale-110">
                        ${!p.isActive ? '<div class="absolute inset-0 bg-black/60 flex items-center justify-center text-red-500 font-bold border border-red-500 m-4 text-xs">OCULTO WEB</div>' : ''}
                        <div class="absolute bottom-0 left-0 bg-black/80 text-white text-[10px] px-2 py-1 w-full flex flex-wrap gap-1">${stockBadges}</div>
                    </div>
                    <div>
                        <div class="font-bold text-white truncate text-sm">${p.name}</div>
                        <div class="flex justify-between items-center mt-1">
                            <div class="text-[#ccff00] font-mono font-bold">C$ ${p.price}</div>
                            <button onclick="openModal('${p.id}')" class="text-[10px] bg-[#222] text-white px-2 py-1 hover:bg-white hover:text-black border border-[#333]">EDITAR</button>
                        </div>
                    </div>`;
                grid.appendChild(card);
            });
            if(filtered.length === 0) grid.innerHTML = '<div class="text-gray-500 text-xs col-span-4 text-center py-10">No se encontraron productos.</div>';
            lucide.createIcons();
        }
        
        window.renderVariantsList = () => {
            const el = document.getElementById('variantsList'); el.innerHTML = '';
            Object.entries(window.tempVariants).forEach(([size, qty]) => {
                el.innerHTML += `
                    <div class="flex justify-between items-center bg-[#111] p-2 border border-[#333] text-xs text-white group hover:border-[#ccff00]">
                        <span class="font-bold w-10">${size}</span>
                        <span class="font-mono text-[#ccff00] flex-1 text-center">${qty} Unid.</span>
                        <button onclick="deleteVariant('${size}')" class="text-neutral-500 hover:text-red-500"><i data-lucide="trash-2" width="14"></i></button>
                    </div>`;
            });
            document.getElementById('variantsData').value = JSON.stringify(window.tempVariants);
            lucide.createIcons();
        }
        window.addVariant = () => {
            const s = document.getElementById('newVariantSize').value.toUpperCase().trim();
            const q = parseInt(document.getElementById('newVariantQty').value);
            if(s && !isNaN(q)) { window.tempVariants[s] = q; document.getElementById('newVariantSize').value = ''; document.getElementById('newVariantQty').value = ''; renderVariantsList(); }
        }
        window.deleteVariant = (s) => { delete window.tempVariants[s]; renderVariantsList(); }
        window.deleteProduct = async () => { if(confirm("¬øSeguro?")) { const id = document.getElementById('editId').value; await deleteDoc(doc(db, "products", id)); closeModal(); } }
        window.closeModal = () => { document.getElementById('modalContent').classList.add('translate-x-full'); setTimeout(()=>document.getElementById('productModal').classList.add('hidden'), 300); }

        // --- POS (REUTILIZADO) ---
        window.filterPos = () => {
             const container = document.getElementById('posGrid');
             const term = document.getElementById('posSearch').value.toLowerCase();
             container.innerHTML = '';
             products.filter(p => p.isActive !== false && p.name.toLowerCase().includes(term)).forEach(p => {
                 container.innerHTML += `
                    <div onclick="addToPos('${p.id}')" class="bg-[#111] border border-[#333] p-2 cursor-pointer hover:border-[#ccff00] group transition-all">
                        <div class="h-24 w-full bg-black mb-2 overflow-hidden">
                            <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
                        </div>
                        <div class="text-xs font-bold text-white truncate">${p.name}</div>
                        <div class="text-[#ccff00] text-xs font-mono">C$ ${p.price}</div>
                    </div>`;
             });
        }
        window.addToPos = (id) => {
             const p = products.find(x => x.id === id);
             if(!p.variants || Object.keys(p.variants).length === 0) { addPosItem(p, 'U', 1); } else {
                 document.getElementById('posVariantProductName').innerText = p.name;
                 const opts = document.getElementById('posVariantOptions'); opts.innerHTML = '';
                 Object.entries(p.variants).forEach(([size, qty]) => {
                     qty = Number(qty); const disabled = qty <= 0;
                     opts.innerHTML += `<button onclick="${disabled ? '' : `addPosItemFromModal('${id}', '${size}')`}" class="p-3 border text-xs flex justify-between font-mono ${disabled ? 'border-red-900 bg-red-900/10 text-red-700 cursor-not-allowed' : 'border-[#333] hover:border-[#ccff00] hover:bg-[#222] text-white'}"><span>${size}</span> <span>${qty}</span></button>`;
                 });
                 document.getElementById('posVariantModal').classList.remove('hidden');
             }
        }
        window.addPosItemFromModal = (id, size) => { const p = products.find(x => x.id === id); addPosItem(p, size, 1); closePosVariantModal(); }
        window.closePosVariantModal = () => document.getElementById('posVariantModal').classList.add('hidden');
        function addPosItem(product, size, qty) { posCart.push({ ...product, size, qty }); renderPosCart(); }
        window.renderPosCart = () => {
            const c = document.getElementById('posCart'); c.innerHTML = ''; let total = 0;
            if(posCart.length === 0) c.innerHTML = '<div class="text-center text-gray-700 text-xs mt-10 font-mono">ESPERANDO ITEMS...</div>';
            posCart.forEach((item, idx) => {
                total += item.price;
                c.innerHTML += `<div class="flex justify-between items-center bg-[#111] p-2 border-l-2 border-[#ccff00] mb-1 animate-slide-up"><div class="text-xs"><div class="text-white font-bold">${item.name} (${item.size})</div><div class="text-gray-500">C$ ${item.price}</div></div><button onclick="posCart.splice(${idx},1); renderPosCart()" class="text-red-500 hover:text-white"><i data-lucide="trash-2" width="12"></i></button></div>`;
            });
            document.getElementById('posTotal').innerText = `C$ ${total.toFixed(2)}`;
            lucide.createIcons();
        }
        window.clearPosCart = () => { posCart = []; renderPosCart(); document.getElementById('posClientName').value = ""; document.getElementById('posClientPhone').value = ""; }
        window.openPaymentModal = () => {
            if(posCart.length === 0) return alert("Carrito vac√≠o");
            const total = posCart.reduce((a,b)=>a+b.price, 0);
            document.getElementById('confClient').innerText = document.getElementById('posClientName').value || "Cliente General";
            document.getElementById('confItems').innerText = posCart.length;
            document.getElementById('confTotal').innerText = "C$ " + total.toFixed(2);
            document.getElementById('posPaymentModal').classList.remove('hidden');
        }
        window.selectPayment = (m) => { document.getElementById('selectedPaymentMethod').value = m; document.querySelectorAll('.pay-opt').forEach(b => { b.classList.remove('bg-[#ccff00]', 'text-black'); if(b.innerText.includes(m.toUpperCase())) b.classList.add('bg-[#ccff00]', 'text-black'); }); }
        window.closePaymentModal = () => document.getElementById('posPaymentModal').classList.add('hidden');
        window.confirmPosSale = async () => {
            const btn = document.getElementById('btnProcessPayment'); btn.innerText = "PROCESANDO..."; btn.disabled = true;
            const total = posCart.reduce((a,b)=>a+b.price, 0);
            const dateCode = new Date().toISOString().slice(2,10).replace(/-/g,'');
            const rand = Math.floor(1000 + Math.random() * 9000);
            const orderId = `POS-${dateCode}-${rand}`;
            const orderData = { orderId, date: serverTimestamp(), customer: { name: document.getElementById('posClientName').value || "Cliente Mostrador", phone: document.getElementById('posClientPhone').value || "", address: "Venta F√≠sica", city: "Managua", department: "Managua" }, items: posCart, total: total, paymentMethod: document.getElementById('selectedPaymentMethod').value, status: 'completed', source: 'POS' };
            const batch = writeBatch(db); const orderRef = doc(collection(db, "orders")); batch.set(orderRef, orderData);
            posCart.forEach(item => { if(item.variants) { const prodRef = doc(db, "products", item.id); batch.update(prodRef, { [`variants.${item.size}`]: increment(-1) }); } });
            await batch.commit(); closePaymentModal(); clearPosCart(); btn.innerText = "FACTURAR"; btn.disabled = false; refreshOrdersManual(); openInvoiceViewer({ id: orderRef.id, ...orderData, date: { seconds: Date.now()/1000 } }); 
        }

        // --- √ìRDENES Y REPORTES (Reutilizados de V7.3) ---
        window.filterOrders = () => {
             const term = document.getElementById('orderSearchInput').value.toLowerCase();
             const tbody = document.getElementById('ordersTableBody'); tbody.innerHTML = '';
             allOrders.filter(o => (o.orderId || '').toLowerCase().includes(term) || (o.customer?.name || '').toLowerCase().includes(term)
             ).forEach(o => renderOrderRow(o, tbody)); lucide.createIcons();
        }
        function renderOrdersTable() { const tbody = document.getElementById('ordersTableBody'); tbody.innerHTML = ''; allOrders.forEach(o => renderOrderRow(o, tbody)); lucide.createIcons(); }
        function renderOrderRow(o, tbody) {
             const date = o.date ? new Date(o.date.seconds*1000).toLocaleDateString() : '-';
             let statusColor = 'text-yellow-500'; if(o.status === 'completed') statusColor = 'text-green-500'; if(o.status === 'cancelled') statusColor = 'text-red-500';
             tbody.innerHTML += `<tr class="hover:bg-[#111] transition-colors border-b border-[#222]"><td class="p-4 text-[#ccff00]">${o.orderId || 'N/A'}</td><td class="p-4 text-gray-500">${date}</td><td class="p-4 font-bold text-white">${o.customer?.name || 'Anon'}</td><td class="p-4">C$ ${o.total.toFixed(2)}</td><td class="p-4 text-[#00f3ff]">${o.shipping > 0 ? 'C$ '+o.shipping : '-'}</td><td class="p-4 text-gray-400 text-[10px] uppercase">${o.paymentMethod}</td><td class="p-4 ${statusColor} font-bold uppercase">${o.status}</td><td class="p-4"><button onclick="viewOrderDetails('${o.id}')" class="bg-[#222] text-white hover:bg-[#ccff00] hover:text-black p-2 rounded-sm transition-colors"><i data-lucide="eye" width="16"></i></button></td></tr>`;
        }
        window.viewOrderDetails = (id) => { const order = allOrders.find(o => o.id === id); openInvoiceViewer(order); }

        async function openInvoiceViewer(order) {
            currentOrderView = order; document.getElementById('viewerOrderId').innerText = "#" + order.orderId;
            const cust = order.customer || {};
            let department = "N/A"; if(order.address && order.address.department) department = order.address.department; else if(cust.department) department = cust.department;
            let fullAddress = "Sin direcci√≥n";
            if(order.address && order.address.address) { fullAddress = `${order.address.address}, ${order.address.neighborhood || ''}`; } else if (cust.detail) { fullAddress = cust.detail; } else if (cust.address) { fullAddress = cust.address; }
            const shippingCost = order.shipping || order.shippingCost || 0;
            const d = document.getElementById('orderDetailPanel');
            d.innerHTML = `<div class="grid grid-cols-2 gap-4 mb-4"><div><span class="text-gray-500 text-[10px] uppercase block">Cliente</span><span class="text-white font-bold">${cust.name}</span></div><div><span class="text-gray-500 text-[10px] uppercase block">Tel√©fono</span><span class="text-[#ccff00] font-mono">${cust.phone}</span></div></div><div class="mb-4"><span class="text-gray-500 text-[10px] uppercase block">Direcci√≥n de Entrega</span><div class="bg-[#111] p-2 border border-[#333] mt-1 text-xs">${fullAddress}<br><span class="text-gray-400">${department}</span>${order.destination ? `<a href="https://maps.google.com/?q=${order.destination.lat},${order.destination.lng}" target="_blank" class="text-[#ff003c] block mt-1 hover:underline">Ver GPS Map</a>` : ''}</div></div><div class="bg-[#111] p-3 border border-[#333]"><span class="text-gray-500 text-[10px] uppercase block mb-2">Items</span>${order.items.map(i => `<div class="flex justify-between text-xs mb-1"><span>${i.qty}x ${i.name} (${i.size})</span><span>C$ ${i.price}</span></div>`).join('')}${shippingCost > 0 ? `<div class="flex justify-between text-xs mb-1 border-t border-[#222] pt-1 text-[#00f3ff]"><span>Env√≠o (${department})</span><span>C$ ${shippingCost}</span></div>` : ''}<div class="border-t border-[#333] mt-2 pt-2 flex justify-between font-bold text-[#ccff00]"><span>TOTAL</span><span>C$ ${order.total.toFixed(2)}</span></div></div>`;
            document.getElementById('orderStatusUpdate').value = order.status;
            const proofUrl = order.receiptUrl || order.paymentProof || order.paymentReceipt || order.voucherUrl || order.receipt;
            const proofContainer = document.getElementById('paymentProofContainer'); const proofImg = document.getElementById('proofImg');
            if(proofUrl) { proofContainer.classList.remove('hidden'); document.getElementById('proofLink').href = proofUrl; proofImg.src = proofUrl; proofImg.classList.remove('hidden'); } else { proofContainer.classList.add('hidden'); }
            generatePDF(order, fullAddress, department, shippingCost);
            document.getElementById('btnUpdateStatus').onclick = async () => { const newStatus = document.getElementById('orderStatusUpdate').value; await updateDoc(doc(db, "orders", order.id), { status: newStatus }); order.status = newStatus; renderOrdersTable(); alert("Estado actualizado"); };
            document.getElementById('btnWhatsapp').onclick = () => { const text = `Hola ${cust.name}, te enviamos tu factura de la orden ${order.orderId}.`; window.open(`https://wa.me/505${cust.phone}?text=${encodeURIComponent(text)}`, '_blank'); };
            document.getElementById('btnPrint').onclick = () => { if(lastGeneratedPdfBlob) { const url = URL.createObjectURL(lastGeneratedPdfBlob); const w = window.open(url); w.onload = () => w.print(); } };
            
            // --- MOSTRAR BOT√ìN DE FINALIZAR SI ES POS ---
            if(order.source === 'POS') { document.getElementById('btnFinishPos').classList.remove('hidden'); } else { document.getElementById('btnFinishPos').classList.add('hidden'); }
            
            document.getElementById('invoiceViewerModal').classList.remove('hidden');
        }
        window.closeInvoiceViewerModal = () => document.getElementById('invoiceViewerModal').classList.add('hidden');
        function generatePDF(o, address, dept, shipping) {
            const { jsPDF } = window.jspdf; const doc = new jsPDF();
            const logo = landingConfig.logo || globalConfig.logo || ""; const title = landingConfig.title || globalConfig.title || "KURA STUDIO";
            if(logo) { try { doc.addImage(logo, 'JPEG', 15, 10, 25, 25); } catch(e){} }
            doc.setFont("helvetica", "bold"); doc.setFontSize(20); doc.text(title.toUpperCase(), 195, 20, { align: "right" });
            doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.text("RUC: J0310000XXXXXX", 195, 26, { align: "right" });
            doc.setFillColor(240, 240, 240); doc.rect(15, 40, 180, 25, 'F');
            doc.setFont("helvetica", "bold"); doc.text("FACTURAR A:", 20, 48); doc.text(`ORDEN #${o.orderId}`, 140, 48);
            const cust = o.customer || {};
            doc.setFont("helvetica", "normal"); doc.text(cust.name, 20, 54); 
            const splitAddress = doc.splitTextToSize(address, 100); doc.text(splitAddress, 20, 59);
            let currentY = 59 + (splitAddress.length * 4); doc.text(`${dept}`, 20, currentY);
            const dateStr = o.date && o.date.seconds ? new Date(o.date.seconds*1000).toLocaleDateString() : new Date().toLocaleDateString();
            doc.text(`Fecha: ${dateStr}`, 140, 54);
            const body = o.items.map(i => [i.qty, `${i.name} - ${i.size}`, `C$ ${i.price.toFixed(2)}`, `C$ ${(i.price * i.qty).toFixed(2)}`]);
            if(shipping > 0) { body.push(['-', `ENV√çO A ${dept}`, `C$ ${shipping}`, `C$ ${shipping}`]); }
            doc.autoTable({ startY: currentY + 10, head: [['CANT', 'DESCRIPCI√ìN', 'PRECIO UNIT.', 'SUBTOTAL']], body: body, theme: 'plain', headStyles: { fillColor: [0,0,0], textColor: [255,255,255], fontStyle: 'bold' }, styles: { fontSize: 10, cellPadding: 3 }, columnStyles: { 0: {halign: 'center'}, 2: {halign: 'right'}, 3: {halign: 'right'} } });
            const finalY = doc.lastAutoTable.finalY + 10; doc.setFont("helvetica", "bold"); doc.setFontSize(14); doc.text(`TOTAL: C$ ${o.total.toFixed(2)}`, 195, finalY, { align: "right" }); doc.setFontSize(8); doc.setFont("helvetica", "italic"); doc.text("Gracias por su compra.", 105, 280, { align: "center" });
            const blob = doc.output('blob'); lastGeneratedPdfBlob = blob; document.getElementById('pdfViewer').src = URL.createObjectURL(blob);
        }

        // --- M√âTODOS DE PAGO (MEJORADO V8) ---
        function renderPaymentConfig() {
             const c = document.getElementById('paymentMethodsContainer'); c.innerHTML = '';
             globalConfig.paymentMethods.forEach((pm, idx) => {
                 let extraFields = '';
                 // TIPO BANCO
                 if(pm.type === 'bank') {
                     extraFields = `
                         <div class="grid grid-cols-3 gap-2">
                             <input class="cyber-input p-2 text-xs" value="${pm.bankName || ''}" onchange="updatePaymentMethod(${idx}, 'bankName', this.value)" placeholder="Nombre Banco">
                             <input class="cyber-input p-2 text-xs font-mono" value="${pm.accountNumber || ''}" onchange="updatePaymentMethod(${idx}, 'accountNumber', this.value)" placeholder="No. Cuenta">
                             <input class="cyber-input p-2 text-xs" value="${pm.holderName || ''}" onchange="updatePaymentMethod(${idx}, 'holderName', this.value)" placeholder="Titular">
                         </div>`;
                 } 
                 // TIPO LINK DE PAGO
                 else if (pm.type === 'link') {
                     extraFields = `
                        <div class="space-y-2 bg-[#050505] p-2 border border-[#333]">
                             <input class="cyber-input w-full p-2 text-xs text-[#00f3ff]" value="${pm.linkUrl || ''}" onchange="updatePaymentMethod(${idx}, 'linkUrl', this.value)" placeholder="URL del Link de Pago">
                             
                             <div class="flex gap-2 items-center">
                                 <input id="pm_qr_${idx}" class="cyber-input flex-1 p-2 text-xs text-gray-500" value="${pm.qrUrl || ''}" onchange="updatePaymentMethod(${idx}, 'qrUrl', this.value)" placeholder="URL Imagen QR">
                                 <div class="upload-area w-10 h-10 flex items-center justify-center bg-[#111]">
                                     <input type="file" accept="image/*" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer" onchange="uploadGenericImage(this, 'pm_qr_${idx}')">
                                     <i data-lucide="upload" width="16" class="text-gray-500"></i>
                                 </div>
                             </div>
                        </div>`;
                 }
                 
                 c.innerHTML += `
                    <div class="bg-[#111] p-4 border border-[#333] relative group space-y-3">
                        <button onclick="removePaymentMethod(${idx})" class="absolute top-2 right-2 text-red-500 hover:text-white">X</button>
                        
                        <div class="flex gap-2 items-center">
                            <span class="text-[10px] text-gray-500 font-bold uppercase w-24">IDENTIFICADOR INTERNO:</span>
                            <input class="cyber-input flex-1 p-2 text-xs font-mono text-[#ccff00] border-[#ccff00]/50" value="${pm.internalName || ''}" onchange="updatePaymentMethod(${idx}, 'internalName', this.value)" placeholder="Ej: Link Camisa Yugi - Managua">
                        </div>

                        <div class="flex gap-2">
                            <select class="cyber-input w-1/3 p-2 text-xs uppercase" onchange="updatePaymentMethod(${idx}, 'type', this.value); renderPaymentConfig()">
                                <option value="generic" ${pm.type==='generic'?'selected':''}>Gen√©rico / QR</option>
                                <option value="bank" ${pm.type==='bank'?'selected':''}>Cuenta Bancaria</option>
                                <option value="link" ${pm.type==='link'?'selected':''}>Link de Pago</option>
                            </select>
                            <input class="cyber-input flex-1 p-2 text-xs font-bold" value="${pm.name}" onchange="updatePaymentMethod(${idx}, 'name', this.value)" placeholder="Nombre Visible al Cliente (Ej: Pago con Tarjeta)">
                        </div>
                        
                        ${extraFields}
                        
                        <textarea class="cyber-input w-full p-2 text-xs h-12" onchange="updatePaymentMethod(${idx}, 'info', this.value)" placeholder="Instrucciones Adicionales...">${pm.info || ''}</textarea>
                    </div>`;
             });
        }
        window.addPaymentMethodInput = () => { globalConfig.paymentMethods.push({type: 'generic', internalName: "Nuevo M√©todo", name: "M√©todo de Pago", info: ""}); renderPaymentConfig(); }
        window.updatePaymentMethod = (idx, field, val) => { globalConfig.paymentMethods[idx][field] = val; }
        window.removePaymentMethod = (idx) => { globalConfig.paymentMethods.splice(idx,1); renderPaymentConfig(); }
        
        // --- CATEGOR√çAS ---
        function renderCategoriesConfig() {
            const c = document.getElementById('categoriesContainer'); c.innerHTML = '';
            globalConfig.categories.forEach((cat, idx) => {
                c.innerHTML += `<div class="flex justify-between bg-[#111] p-2 border border-[#333] text-xs"><span class="text-white">${cat}</span><button onclick="removeCategory(${idx})" class="text-red-500">X</button></div>`;
            });
        }
        window.addCategoryUI = () => { const val = document.getElementById('newCategoryInput').value.trim().toUpperCase(); if(val) { globalConfig.categories.push(val); renderCategoriesConfig(); document.getElementById('newCategoryInput').value = ''; } }
        window.removeCategory = (idx) => { globalConfig.categories.splice(idx,1); renderCategoriesConfig(); }

        // --- SAVE CONFIGS ---
        window.saveGlobalConfig = async () => {
             const newData = {
                 title: document.getElementById('confTitle').value,
                 logo: document.getElementById('confLogo').value,
                 banner: document.getElementById('confBanner').value,
                 whatsapp: document.getElementById('confWhatsapp').value,
                 instagram: document.getElementById('confInsta').value,
                 categories: globalConfig.categories,
                 paymentMethods: globalConfig.paymentMethods
             };
             await setDoc(doc(db, "settings", "store_config"), newData, { merge: true });
             alert("Configuraci√≥n Guardada Correctamente");
        }
        // --- PORTADA CONFIG ---
        function applyConfigToUI() { document.getElementById('confTitle').value = globalConfig.title || ""; document.getElementById('confLogo').value = globalConfig.logo || ""; document.getElementById('confBanner').value = globalConfig.banner || ""; document.getElementById('confWhatsapp').value = globalConfig.whatsapp || ""; document.getElementById('confInsta').value = globalConfig.instagram || ""; renderCategoriesConfig(); renderPaymentConfig(); }
        function applyLandingToUI() { document.getElementById('landingTitle').value = landingConfig.title || ""; document.getElementById('landingSubtitle').value = landingConfig.subtitle || ""; document.getElementById('landingLogo').value = landingConfig.logo || ""; document.getElementById('landingBgImage').value = landingConfig.bgImage || ""; document.getElementById('landingBtnText').value = landingConfig.btnText || ""; document.getElementById('landingStoreUrl').value = landingConfig.storeUrl || ""; document.getElementById('landingInsta').value = landingConfig.instagram || ""; document.getElementById('landingTiktok').value = landingConfig.tiktok || ""; document.getElementById('landingWhatsapp').value = landingConfig.whatsapp || ""; }
        window.saveLandingConfig = async () => {
             const d = { title: document.getElementById('landingTitle').value, subtitle: document.getElementById('landingSubtitle').value, logo: document.getElementById('landingLogo').value, bgImage: document.getElementById('landingBgImage').value, btnText: document.getElementById('landingBtnText').value, storeUrl: document.getElementById('landingStoreUrl').value, instagram: document.getElementById('landingInsta').value, tiktok: document.getElementById('landingTiktok').value, whatsapp: document.getElementById('landingWhatsapp').value };
             await setDoc(doc(db, "settings", "landing_page_v2"), d, { merge: true }); landingConfig = d; alert("Portada guardada");
        }
        window.switchTab = (t) => { document.querySelectorAll('.view-section').forEach(d => d.classList.add('hidden')); document.getElementById(`view-${t}`).classList.remove('hidden'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active')); document.getElementById(`tab-${t}`).classList.add('nav-active'); }
        lucide.createIcons();
    </script>
</body>
</html>
