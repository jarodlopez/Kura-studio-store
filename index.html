<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kura Studio | Anime Streetwear</title>
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Chakra+Petch:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;800&display=swap" rel="stylesheet">

    <!-- FIREBASE (V8 Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <!-- REACT 18 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- LUCIDE ICONS -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --neon-red: #ff003c;
            --acid-green: #ccff00;
            --cyber-black: #050505;
            --panel-bg: #0a0a0a;
            --border-col: #222;
        }

        body { 
            font-family: 'Chakra Petch', sans-serif;
            background-color: var(--cyber-black); 
            color: #e5e5e5; 
            margin: 0; 
            overflow-x: hidden;
        }

        /* --- EFECTO DE RUIDO --- */
        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- TYPOGRAPHY & HEADER --- */
        .font-logo { font-family: 'Syncopate', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Letras Japonesas Verticales con Efecto */
        .jp-dynamic {
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-size: 10px;
            font-weight: bold;
            color: var(--neon-red);
            letter-spacing: 3px;
            height: 40px;
            line-height: 1;
            animation: energy-pulse 2s infinite alternate;
            text-shadow: 0 0 5px var(--neon-red);
            margin-left: 10px;
        }

        @keyframes energy-pulse {
            0% { opacity: 0.8; text-shadow: 0 0 2px var(--neon-red); }
            100% { opacity: 1; text-shadow: 0 0 8px var(--neon-red); }
        }

        /* --- MARQUESINA --- */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* --- GLITCH TEXT --- */
        .glitch-text { position: relative; }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--cyber-black);
        }
        .glitch-text::before {
            left: 2px; text-shadow: -1px 0 var(--neon-red); clip: rect(24px, 550px, 90px, 0); animation: glitch-anim 3s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            left: -2px; text-shadow: -1px 0 var(--acid-green); clip: rect(85px, 550px, 140px, 0); animation: glitch-anim 2s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(13px, 9999px, 81px, 0); } 20% { clip: rect(98px, 9999px, 11px, 0); }
            40% { clip: rect(5px, 9999px, 66px, 0); } 60% { clip: rect(32px, 9999px, 88px, 0); }
            80% { clip: rect(76px, 9999px, 3px, 0); } 100% { clip: rect(10px, 9999px, 92px, 0); }
        }

        /* --- UI COMPONENTS --- */
        .btn-cyber {
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: all 0.2s;
        }
        .btn-cyber:hover { transform: translate(-2px, -2px); box-shadow: 4px 4px 0 var(--neon-red); }
        
        .shop-input {
            width: 100%; background: #111; border: 1px solid #333; color: white; padding: 12px;
            font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; transition: border-color 0.3s;
        }
        .shop-input:focus { border-color: var(--neon-red); outline: none; }

        /* Toast Animation */
        .toast-enter { transform: translateY(-20px); opacity: 0; }
        .toast-active { transform: translateY(0); opacity: 1; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-red); }
    </style>
</head>
<body>
    <div class="noise-overlay"></div>
    <div id="root"></div>

    <script type="text/babel">
        // --- 0. MOCK DATA ---
        const MOCK_PRODUCTS = [
            { id: '1', name: 'UNIT-01 HOODIE', price: 1200, category: 'OUTERWEAR', image: 'https://images.unsplash.com/photo-1556905055-8f358a7a47b2?q=80&w=2070&auto=format&fit=crop', description: 'Sudadera oversize de alto gramaje. Algod√≥n peinado. Estampado puff print en espalda.' },
            { id: '2', name: 'CYBER CARGO V2', price: 1800, category: 'BOTTOMS', image: 'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?q=80&w=1997&auto=format&fit=crop', description: 'Pantal√≥n cargo t√©cnico con m√∫ltiples bolsillos y correas ajustables. Tela ripstop.' },
            { id: '3', name: 'AKIRA TEE', price: 850, category: 'TOPS', image: 'https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?q=80&w=1974&auto=format&fit=crop', description: 'Camiseta gr√°fica edici√≥n limitada. Lavado acid wash para efecto vintage.' },
            { id: '4', name: 'MECHA VEST', price: 2100, category: 'OUTERWEAR', image: 'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=2020&auto=format&fit=crop', description: 'Chaleco t√°ctico utilitario. Ideal para layering.' },
        ];

        // --- 1. CONFIG & UTILS ---
        const { useState, useEffect, useMemo } = React;
        const { createRoot } = ReactDOM;
        
        const PHONE = "50584016969";
        const BANK_ACCOUNT = "123456789"; 
        const KASH_QR_URL = "https://raw.githubusercontent.com/Ferretecnica/image-smoosh/refs/heads/main/file_00000000d4d061f9a97adcddd9e7c236.png";

        const firebaseConfig = {
            apiKey: "AIzaSyAztg4F0twRi2NOP8MayAOUYB0ZtHgkss0",
            authDomain: "kodialabsnic.firebaseapp.com",
            projectId: "kodialabsnic",
            storageBucket: "kodialabsnic.firebasestorage.app",
            messagingSenderId: "740746852984",
            appId: "1:740746852984:web:972aa34592aef881630b8d"
        };

        let db, auth, isFirebaseActive = false;
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            isFirebaseActive = true;
        } catch (e) { console.warn("Firebase Error (Mock Mode):", e); }

        const Icon = ({ name, size = 20, className }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        const formatPrice = (p) => typeof p === 'number' ? p.toFixed(2) : "0.00";

        // --- 2. COMMON UI ---
        const Button = ({ children, onClick, variant = 'primary', className = '' }) => {
            const baseClass = "btn-cyber font-mono font-bold uppercase tracking-widest px-8 py-4 flex items-center justify-center gap-3 text-sm";
            const variants = {
                primary: "bg-[#ff003c] text-white hover:bg-white hover:text-black",
                outline: "bg-transparent border border-neutral-600 text-white hover:border-[#ff003c] hover:text-[#ff003c]",
                acid: "bg-[#ccff00] text-black hover:bg-white"
            };
            return <button onClick={onClick} className={`${baseClass} ${variants[variant]} ${className}`}>{children}</button>;
        };

        const Toast = ({ show, message }) => (
            <div className={`fixed top-24 right-4 z-[999] bg-[#111] border-l-4 border-[#ff003c] p-4 shadow-2xl flex items-center gap-3 transition-all duration-300 ${show ? 'toast-active' : 'toast-enter opacity-0'}`}>
                <div className="bg-[#ff003c] rounded-full p-1 w-6 h-6 flex items-center justify-center"><Icon name="check" size={14} className="text-white"/></div>
                <span className="text-white font-mono text-xs font-bold uppercase tracking-widest">{message}</span>
            </div>
        );

        const Marquee = () => (
            <div className="bg-[#ff003c] text-black font-bold font-mono text-xs py-1 border-b border-[#ff003c] marquee-container select-none">
                <div className="marquee-content">
                    <span className="mx-4">üì¶ENV√çOS A TODA NICARAGUA </span><span className="mx-4">///</span>
                    <span className="mx-4">NEW COLLECTION AVAILABLE NOW</span><span className="mx-4">///</span>
                    <span className="mx-4">WORLDWIDE SHIPPING</span><span className="mx-4">///</span>
                    <span className="mx-4">KURA STUDIO 2026</span><span className="mx-4">///</span>
                    <span className="mx-4">üì¶ENV√çOS A TODA NICARAGUA </span><span className="mx-4">///</span>
                    <span className="mx-4">NEW COLLECTION AVAILABLE NOW</span>
                </div>
            </div>
        );

        // --- 3. SECTIONS ---

        // HERO CARROUSEL (FIXED: Sin im√°genes placeholder, espera a que carguen los datos)
        const Hero = ({ products }) => {
            const [index, setIndex] = useState(0);
            
            // Solo usamos im√°genes v√°lidas de productos reales. Si no hay, array vac√≠o.
            const images = useMemo(() => {
                return products.filter(p => p.image).map(p => p.image).slice(0, 4);
            }, [products]);

            useEffect(() => {
                if (images.length <= 1) return;
                const t = setInterval(() => setIndex(prev => (prev + 1) % images.length), 4000);
                return () => clearInterval(t);
            }, [images]);

            return (
                <div className="relative h-[85vh] w-full bg-black overflow-hidden flex items-center justify-center border-b border-[#222]">
                    {/* Background: Si no hay im√°genes, se ve negro. Si hay, muestra el carrusel */}
                    {images.length > 0 ? images.map((img, i) => (
                        <div key={i} className={`absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ${i === index ? 'opacity-60' : 'opacity-0'}`} style={{backgroundImage: `url('${img}')`}}></div>
                    )) : (
                        <div className="absolute inset-0 bg-[#050505]"></div> // Fondo negro limpio mientras carga
                    )}

                    <div className="absolute inset-0 bg-gradient-to-t from-[#050505] via-transparent to-black/30"></div>
                    <div className="absolute inset-0 pointer-events-none" style={{backgroundImage: 'linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)', backgroundSize: '50px 50px'}}></div>

                    <div className="relative z-10 text-center px-4">
                        <div className="inline-block border border-[#ff003c] px-3 py-1 mb-6 bg-black/60 backdrop-blur-sm">
                            <span className="text-[#ff003c] text-[10px] font-bold tracking-[0.4em] uppercase">COLLECTION 2026</span>
                        </div>
                        <h1 className="text-5xl md:text-8xl font-black font-logo uppercase text-white mb-8 tracking-tighter glitch-text" data-text="ANIME CULTURE">
                            ANIME<br/>CULTURE
                        </h1>
                        <div className="mt-8 flex justify-center">
                            <Button onClick={() => document.getElementById('shop').scrollIntoView({ behavior: 'smooth' })} className="mx-auto">VER DROPS</Button>
                        </div>
                    </div>
                </div>
            );
        };

        const ProductDetail = ({ product, onBack, onAdd }) => {
            const [size, setSize] = useState('M');
            const [showTable, setShowTable] = useState(false); // Estado para la gu√≠a

            // COMPONENTE TABLA DE TALLAS (Reintegrado)
            const SizeTable = () => (
                <div className="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4">
                    <div className="bg-[#111] border border-[#ff003c] w-full max-w-2xl relative p-6 max-h-[90vh] overflow-y-auto animate-fade-in shadow-[0_0_50px_rgba(255,0,60,0.1)]">
                        <button onClick={() => setShowTable(false)} className="absolute top-4 right-4 text-white hover:text-[#ff003c]"><Icon name="x"/></button>
                        <h3 className="text-[#ff003c] font-bold uppercase tracking-widest mb-6 border-b border-[#333] pb-2 text-center">GU√çA DE TALLAS (CM)</h3>
                        <table className="w-full text-center text-sm font-mono text-neutral-400">
                            <thead className="bg-[#0a0a0a] text-white font-bold border-b border-[#333]"><tr><th className="p-3 text-left">MEDIDA</th><th>XS</th><th>S</th><th>M</th><th>L</th></tr></thead>
                            <tbody className="divide-y divide-neutral-900">
                                <tr><td className="p-3 text-left text-white">Pecho</td><td>42</td><td>47</td><td>52</td><td>58</td></tr>
                                <tr><td className="p-3 text-left text-white">Hombro a hombro</td><td>45</td><td>49</td><td>54.5</td><td>57.4</td></tr>
                                <tr><td className="p-3 text-left text-white">Largo total</td><td>69</td><td>70</td><td>73.5</td><td>76</td></tr>
                                <tr><td className="p-3 text-left text-white">Abertura Manga</td><td>18</td><td>19</td><td>22</td><td>22.2</td></tr>
                                <tr><td className="p-3 text-left text-white">Largo Manga</td><td>22</td><td>23</td><td>25</td><td>26</td></tr>
                                <tr><td className="p-3 text-left text-white">Ancho cuello</td><td>3</td><td>3</td><td>3</td><td>3</td></tr>
                                <tr><td className="p-3 text-left text-white">Prof. Escote</td><td>9</td><td>10</td><td>11</td><td>12</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pt-32 pb-20 px-4 container mx-auto animate-fade-in">
                    {showTable && <SizeTable />}
                    <button onClick={onBack} className="flex items-center gap-2 text-neutral-500 hover:text-[#ff003c] mb-8 font-mono text-xs font-bold uppercase tracking-widest transition-colors">
                        <Icon name="arrow-left" size={16}/> VOLVER
                    </button>
                    <div className="grid lg:grid-cols-2 gap-16">
                        <div className="bg-[#0a0a0a] border border-[#222] relative group h-[500px] lg:h-[600px] w-full flex items-center justify-center p-4">
                            <img src={product.image} className="max-w-full max-h-full w-auto h-auto object-contain transition-transform duration-700 group-hover:scale-105"/>
                            <div className="absolute bottom-4 right-4 bg-black/80 px-2 py-1 text-[10px] text-neutral-400 font-mono border border-[#333]">V.01 DISPLAY</div>
                        </div>

                        <div className="flex flex-col justify-center">
                            <h2 className="text-[#ff003c] font-mono text-sm tracking-[0.2em] mb-2">{product.category}</h2>
                            <h1 className="text-5xl font-black font-logo text-white uppercase mb-6 leading-none">{product.name}</h1>
                            <div className="text-3xl font-mono font-bold text-[#ccff00] mb-8 border-b border-[#222] pb-6">C$ {formatPrice(product.price)}</div>
                            <p className="text-neutral-400 mb-8 leading-relaxed font-light">{product.description}</p>
                            
                            <div className="mb-10">
                                <div className="flex justify-between items-center mb-4">
                                    <span className="text-xs font-bold text-white font-mono uppercase">TALLA</span>
                                    <button onClick={() => setShowTable(true)} className="text-[10px] text-[#ff003c] underline font-mono font-bold uppercase hover:text-white">VER GU√çA DE TALLAS</button>
                                </div>
                                <div className="flex gap-4">
                                    {['S','M','L','XL'].map(s => (
                                        <button key={s} onClick={() => setSize(s)} className={`w-14 h-14 border flex items-center justify-center font-mono font-bold text-sm transition-all ${size===s ? 'bg-white text-black border-white' : 'border-[#333] text-neutral-500 hover:border-[#ff003c] hover:text-[#ff003c]'}`}>{s}</button>
                                    ))}
                                </div>
                            </div>
                            <Button onClick={() => onAdd(product, size)} variant="acid" className="w-full">A√ëADIR AL CARRITO</Button>
                        </div>
                    </div>
                </div>
            );
        };

        const CartDrawer = ({ isOpen, onClose, cart, remove, onCheckout }) => {
            if (!isOpen) return null;
            const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
            return (
                <div className="fixed inset-0 z-[100] flex justify-end">
                    <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative w-full max-w-md bg-[#050505] border-l border-[#222] h-full flex flex-col shadow-2xl">
                        <div className="p-6 border-b border-[#222] flex justify-between items-center bg-[#0a0a0a]">
                            <h2 className="font-logo font-bold text-xl uppercase text-white">CARRITO ({cart.length})</h2>
                            <button onClick={onClose} className="hover:text-[#ff003c] transition-colors"><Icon name="x" size={24}/></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-6">
                            {cart.length === 0 ? <div className="text-center mt-20 text-neutral-600 font-mono">VAC√çO</div> : cart.map((item, i) => (
                                <div key={i} className="flex gap-4 bg-[#0a0a0a] p-3 border border-[#222] relative">
                                    <img src={item.image} className="w-20 h-24 object-cover grayscale"/>
                                    <div className="flex flex-col justify-between py-1">
                                        <div><h4 className="font-bold text-white text-sm uppercase">{item.name}</h4><span className="text-xs font-mono text-neutral-500">{item.size} / x{item.qty}</span></div>
                                        <span className="text-[#ccff00] font-mono font-bold">C$ {formatPrice(item.price)}</span>
                                    </div>
                                    <button onClick={() => remove(i)} className="absolute top-2 right-2 text-neutral-600 hover:text-[#ff003c]"><Icon name="trash-2" size={16}/></button>
                                </div>
                            ))}
                        </div>
                        {cart.length > 0 && (
                            <div className="p-6 border-t border-[#222] bg-[#0a0a0a]">
                                <div className="flex justify-between items-end mb-6 font-mono"><span className="text-neutral-500 text-sm">TOTAL</span><span className="text-2xl font-bold text-white">C$ {formatPrice(total)}</span></div>
                                <Button className="w-full" onClick={onCheckout}>PAGAR AHORA</Button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const Checkout = ({ cart, subtotal, onBack, onFinish }) => {
            const [step, setStep] = useState(1);
            const [data, setData] = useState({ name: '', phone: '', address: '', method: '', cash: '' });
            const [orderId, setOrderId] = useState(null);
            const [copied, setCopied] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!data.method) return alert("Selecciona m√©todo de pago");
                const newId = `ORD-${Date.now().toString().slice(-6)}`;
                setOrderId(newId);
                if (isFirebaseActive && db) {
                    try { await db.collection('orders').add({ ...data, cart, subtotal, total: subtotal, id: newId, date: new Date() }); } catch(e){}
                }
                setStep(2);
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(BANK_ACCOUNT);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            if (step === 2) {
                return (
                    <div className="min-h-screen pt-32 px-4 flex items-center justify-center pb-20">
                        <div className="max-w-md w-full bg-[#111] border border-[#ff003c] p-8 text-center relative shadow-[0_0_50px_rgba(255,0,60,0.1)]">
                            <div className="w-16 h-16 bg-[#ff003c] rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_#ff003c]">
                                <Icon name="check" size={32} className="text-white"/>
                            </div>
                            <h2 className="text-2xl font-black font-logo uppercase mb-2">¬°ORDEN CONFIRMADA!</h2>
                            <p className="text-[#ff003c] font-mono text-xl font-bold mb-6">{orderId}</p>

                            <div className="bg-[#0a0a0a] border border-[#333] p-6 mb-8 rounded">
                                <p className="text-neutral-400 text-xs font-mono mb-4 uppercase tracking-widest">M√âTODO: <span className="text-white font-bold">{data.method}</span></p>
                                
                                {data.method === 'Kash' && (
                                    <div className="flex flex-col items-center animate-fade-in">
                                        <p className="text-white text-xs font-bold mb-3 uppercase">Escanea para pagar</p>
                                        <div className="bg-white p-2 rounded shadow-lg">
                                            <img src={KASH_QR_URL} className="w-48 h-48 object-contain"/>
                                        </div>
                                    </div>
                                )}

                                {data.method === 'Transferencia' && (
                                    <div className="animate-fade-in">
                                        <p className="text-neutral-500 text-[10px] uppercase mb-1">CUENTA BAC (C√≥rdobas)</p>
                                        <div className="text-xl md:text-2xl text-[#ccff00] font-mono font-bold mb-4 break-all bg-black/50 p-2 border border-[#333] rounded">
                                            {BANK_ACCOUNT}
                                        </div>
                                        <Button onClick={copyToClipboard} variant="outline" className="w-full py-2 text-xs h-10 border-neutral-700">
                                            {copied ? <span className="flex items-center gap-2"><Icon name="check" size={14}/> COPIADO</span> : <span className="flex items-center gap-2"><Icon name="copy" size={14}/> COPIAR CUENTA</span>}
                                        </Button>
                                    </div>
                                )}
                                
                                {data.method === 'Efectivo' && (
                                    <p className="text-neutral-300 text-sm italic">Prepara tu efectivo (C$ {data.cash || subtotal}) para cuando llegue el repartidor.</p>
                                )}
                            </div>

                            <Button onClick={() => {
                                let msg = `üéå *PEDIDO ${orderId}* üéå\n\n*Cliente:* ${data.name}\n*Pago:* ${data.method}\n*Total:* C$ ${formatPrice(subtotal)}\n\n*ITEMS:* ${cart.length}`;
                                window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
                                onFinish();
                            }} className="w-full mb-4">ENVIAR A WHATSAPP</Button>
                            
                            <Button onClick={onFinish} variant="outline" className="w-full">VOLVER A LA TIENDA</Button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pt-32 pb-12 px-4 bg-[#020202]">
                    <div className="max-w-7xl mx-auto grid md:grid-cols-2 gap-12">
                        <div>
                            <button onClick={onBack} className="mb-6 text-neutral-500 flex items-center gap-2 text-xs font-bold uppercase"><Icon name="arrow-left" size={14}/> VOLVER</button>
                            <h1 className="text-3xl font-black font-logo uppercase mb-8">CHECKOUT</h1>
                            <form onSubmit={handleSubmit} className="space-y-8">
                                <div>
                                    <h3 className="text-sm font-bold uppercase tracking-widest text-white border-b border-neutral-800 pb-2 mb-4">1. INFORMACI√ìN DE ENV√çO</h3>
                                    <div className="space-y-4">
                                        <input className="shop-input" placeholder="Nombre Completo" value={data.name} onChange={e=>setData({...data, name:e.target.value})} required/>
                                        <input className="shop-input" placeholder="WhatsApp" value={data.phone} onChange={e=>setData({...data, phone:e.target.value})} required/>
                                        <input className="shop-input" placeholder="Direcci√≥n Exacta" value={data.address} onChange={e=>setData({...data, address:e.target.value})} required/>
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-sm font-bold uppercase tracking-widest text-white border-b border-neutral-800 pb-2 mb-4">2. PAGO</h3>
                                    <div className="grid grid-cols-3 gap-3 mb-4">
                                        {['Transferencia', 'Efectivo', 'Kash'].map(m => (
                                            <button key={m} type="button" onClick={()=>setData({...data, method:m})} className={`p-4 border text-xs font-bold uppercase ${data.method===m ? 'border-[#ff003c] bg-[#ff003c]/10 text-white' : 'border-neutral-800 text-neutral-500'}`}>{m}</button>
                                        ))}
                                    </div>
                                    {data.method === 'Efectivo' && <input className="shop-input" placeholder="¬øCon cu√°nto pagas?" value={data.cash} onChange={e=>setData({...data, cash:e.target.value})} required/>}
                                </div>
                            </form>
                        </div>
                        <div className="bg-[#0a0a0a] border border-[#222] p-8 h-fit md:sticky md:top-24">
                            <h3 className="text-sm font-bold uppercase tracking-widest text-white mb-6">RESUMEN</h3>
                            <div className="space-y-4 mb-6 max-h-60 overflow-y-auto">
                                {cart.map((i, idx) => (
                                    <div key={idx} className="flex gap-4 items-center">
                                        <div className="w-12 h-16 bg-[#111] relative"><img src={i.image} className="w-full h-full object-cover"/></div>
                                        <div className="flex-1"><h4 className="text-xs font-bold text-white line-clamp-1">{i.name}</h4><p className="text-[10px] text-neutral-500">{i.size} x{i.qty}</p></div>
                                        <p className="text-xs font-mono">C$ {formatPrice(i.price * i.qty)}</p>
                                    </div>
                                ))}
                            </div>
                            <div className="flex justify-between text-white font-bold text-lg pt-4 border-t border-[#222] mt-4"><span>TOTAL</span><span>C$ {formatPrice(subtotal)}</span></div>
                            <Button onClick={handleSubmit} className="w-full mt-6 text-lg">FINALIZAR PEDIDO</Button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [view, setView] = useState('home');
            const [products, setProducts] = useState([]);
            const [cart, setCart] = useState([]);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [toast, setToast] = useState({ show: false, msg: '' });

            useEffect(() => {
                const loadData = async () => {
                    if (isFirebaseActive) {
                        try {
                            const snap = await db.collection('products').orderBy('createdAt', 'desc').get();
                            if (!snap.empty) setProducts(snap.docs.map(d => ({id:d.id, ...d.data()})));
                            else setProducts(MOCK_PRODUCTS);
                        } catch (e) { setProducts(MOCK_PRODUCTS); }
                    } else { setProducts(MOCK_PRODUCTS); }
                };
                loadData();
                const saved = localStorage.getItem('kura_cart');
                if (saved) setCart(JSON.parse(saved));
            }, []);

            useEffect(() => { localStorage.setItem('kura_cart', JSON.stringify(cart)); }, [cart]);
            useEffect(() => { window.scrollTo(0,0); setTimeout(() => window.lucide?.createIcons(), 100); }, [view, isCartOpen]);

            const showToast = (msg) => {
                setToast({ show: true, msg });
                setTimeout(() => setToast({ show: false, msg: '' }), 3000);
            };

            const addToCart = (product, size) => {
                setCart(prev => {
                    const exists = prev.find(i => i.id === product.id && i.size === size);
                    if (exists) return prev.map(i => i.id === product.id && i.size === size ? { ...i, qty: i.qty + 1 } : i);
                    return [...prev, { ...product, size, qty: 1 }];
                });
                showToast(`${product.name} AGREGADO`);
                setView('home');
            };

            const removeFromCart = (index) => setCart(cart.filter((_, i) => i !== index));

            const cartTotal = cart.reduce((acc, item) => acc + (Number(item.price) * item.qty), 0);

            return (
                <div className="min-h-screen flex flex-col">
                    <Marquee />
                    <Toast show={toast.show} message={toast.msg} />
                    
                    <nav className="sticky top-0 z-50 bg-[#050505]/90 backdrop-blur-md border-b border-[#222] h-20 px-6 flex items-center justify-between">
                        <div className="flex items-center gap-2 cursor-pointer group" onClick={() => setView('home')}>
                            <span className="font-logo font-bold text-2xl tracking-tighter text-white group-hover:text-[#ff003c] transition-colors">KURA STUDIO</span>
                            <span className="jp-dynamic">„ÇØ„É©„Çπ„Çø„Ç∏„Ç™</span>
                        </div>
                        
                        <div className="flex items-center gap-6">
                            <button className="relative group" onClick={() => setIsCartOpen(true)}>
                                <Icon name="shopping-bag" className="text-white group-hover:text-[#ff003c] transition-colors"/>
                                {cart.length > 0 && <span className="absolute -top-2 -right-2 bg-[#ccff00] text-black text-[10px] font-bold w-4 h-4 flex items-center justify-center rounded-sm">{cart.length}</span>}
                            </button>
                        </div>
                    </nav>

                    <main className="flex-1">
                        {view === 'home' && (
                            <>
                                <Hero products={products} />
                                <div id="shop" className="container mx-auto px-6 py-24">
                                    <div className="flex justify-between items-end mb-12 border-b border-[#222] pb-4">
                                        <h2 className="text-4xl font-black font-logo text-white uppercase">CAT√ÅLOGO</h2>
                                        <span className="font-mono text-[#ff003c] text-xs font-bold">{products.length} ITEMS</span>
                                    </div>
                                    <div className="grid sm:grid-cols-2 lg:grid-cols-4 gap-8">
                                        {products.map(product => (
                                            <div key={product.id} className="group cursor-pointer" onClick={() => { setSelectedProduct(product); setView('product'); }}>
                                                <div className="aspect-[3/4] overflow-hidden bg-[#0a0a0a] border border-[#222] relative mb-4">
                                                    <img src={product.image} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-700"/>
                                                    <div className="absolute top-2 left-0 bg-[#ff003c] text-white text-[9px] font-bold px-2 py-1 uppercase tracking-widest translate-x-[-100%] group-hover:translate-x-0 transition-transform">NEW</div>
                                                </div>
                                                <div className="px-2">
                                                    <p className="text-[10px] text-neutral-500 font-bold uppercase tracking-widest mb-1">{product.category}</p>
                                                    <h3 className="text-sm font-bold text-white uppercase truncate mb-2">{product.name}</h3>
                                                    <span className="font-mono text-lg font-bold text-[#ff003c]">C$ {formatPrice(product.price)}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}

                        {view === 'product' && selectedProduct && (
                            <ProductDetail product={selectedProduct} onBack={() => setView('home')} onAdd={addToCart} />
                        )}

                        {view === 'checkout' && (
                            <Checkout cart={cart} subtotal={cartTotal} onBack={() => setView('home')} onFinish={() => { setCart([]); setView('home'); }} />
                        )}
                    </main>

                    <footer className="bg-[#0a0a0a] border-t border-[#222] py-12">
                        <div className="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
                            <span className="font-logo font-bold text-2xl text-[#333]">KURA STUDIO</span>
                            <p className="text-neutral-600 text-[10px] font-mono uppercase tracking-widest">¬© 2026 KURA STUDIO. ALL RIGHTS RESERVED.</p>
                        </div>
                    </footer>

                    <CartDrawer 
                        isOpen={isCartOpen} 
                        onClose={() => setIsCartOpen(false)} 
                        cart={cart}
                        remove={removeFromCart}
                        onCheckout={() => { setIsCartOpen(false); setView('checkout'); }}
                    />
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


